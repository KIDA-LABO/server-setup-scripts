<span style="color: red; ">[CONFIDENTIAL]</span> ユーザ登録仕様書
=== 

本仕様書は、「研究室合同サーバ勉強会」カリキュラム内にて構築される、サーバシステムにおけるユーザ登録に関わる仕様を規定するものである。ここで規定する仕様及び手続きは、大学機関内で運営される研究室にて、学術目的で使用されるサーバシステムを想定する。

## ユーザの種別

本章では、サーバシステムにおけるユーザの種別を定義する。本仕様書において、高い権限を有するものから順に、以下のようにユーザを定義する。

- ルートユーザ
- 管理者
- モデレータ
- 一般ユーザ(学部、修士、博士)

### ルートユーザ

UNIX系システムにおいて、`root`と表現されるユーザであり、最高権限を有するユーザを指す。  
システム利用者がこのユーザ種別である限り、管理者権限を認証不要で使用することができるため、**基本的に実際の利用者が、ルートユーザに区分されることが無いようにすべき**である。

### 管理者
システムの管理権限を有し、システムの保守・管理業務を行うユーザを指す。  
UNIX系システムで使用される、sudoコマンドを発行できる権限を持ち、後述する「モデレータ」ユーザの上位ユーザに当たる。  
このユーザは、「モデレータ」ユーザとともにシステムの管理を行い、システム内で上位権限が要求されるような作業を実施する。

### モデレータ
「管理者」ユーザとともに、システムの保守・管理業務を行うユーザを指す。
「sudo」コマンド発行を始めとする、上位権限が要求されない範囲での保守・管理業務を実施し、上位権限が必要になった場合は、「管理者」ユーザに指示を仰ぐ。

### 一般ユーザ(学部、修士、博士)
システムの保守・管理業務を行うなど、特殊な役割が無いその他の一般ユーザを指す。
新規に登録されたユーザは、基本的にはこのユーザ区分に割り当てられる。

## 権限(ユーザグループ)の種別

本章では、サーバシステムにおいて各ユーザに設定される、ユーザグループを定義する。 

ユーザグループの割当により、各ユーザに付与される最終的な権限が決定する。

### Sudores (sudore)
「sudo」コマンドを発行できる、システムの保守・管理業務を行うユーザグループ。  
「管理者」ユーザがこの種別に属する。

### Moderator (moderator)
「sudo」コマンドなど上級権限はないが、システムの保守・管理業務を行うユーザグループ。  
「モデレータ」ユーザがこの種別に属する。

### DockerUser (docker)
Dockerシステムに関連する、コマンドを発行できるユーザグループ。  
Dockerを用いる必要があるユーザは、この種別に属する。

### NormalUser (user)
上記以外の、特別な権限が付与されないユーザグループ。  
「一般」ユーザがこの種別に属する。

## ユーザ情報の設定について

本章では、ユーザ登録を行う際に、システムへ設定する情報について規定する。 

一般的なUNIX系システムにおけるユーザ管理では、登録時に「ユーザ名」「パスワード」の2項目を設定するが、対象とするシステムによって項目が異なる。 

ここではUNIX系システムの場合を対象とし、規定する。

### ユーザ名

各ユーザをシステム上で識別するために、ユーザ個人で設定するパラメータである。 

他ユーザと混同することを避けるため、このパラメータは各ユーザについて一意である必要がある。 

ユーザ名のフォーマットについては、以下のようなパターンが挙げられるが、システムを運用する組織によって適切と考えられるものを選択することとする。
- ニックネーム  
    ユーザ個人で好みの名称を設定する。  
    ユーザ本人は認証時の入力の手間などを考慮し、自由に設定することができるが、他ユーザから個人を認識されづらい。
- 本名  
    ユーザ個人の本名を、フルネーム(e.g. KagawaIchiro)ないし省略形(e.g. k.ichiro)で設定する。  

- 学籍番号  
    所属する教育機関から割り振られている、一意な個人番号で設定する。

### パスワード

ユーザアカウントにアクセスするための、認証情報を指す。
セキュリティ面を考慮し、大文字・小文字英数字(必要に応じて+記号)で、構成されるべきと考えられているが、ここでは詳細には定義しない。

## ユーザ登録の手続きについて

本章では、ユーザ登録を行う際の手続きについて規定する。  
本作業は、管理者管轄の下実施されるものとする。  

一般的なUNIX系システムで行われる、一連の手続きを以下に示す。  
1. ```admin```ユーザグループに属するユーザアカウントで、システムへログインする。
2. ```useradd```コマンドを発行し、ユーザ登録を行う。  
以下にコマンドのフォーマットを示す。このステップで、ユーザ名と所属するユーザグループを指定する。基本的には、一般ユーザ(```user```ユーザグループ)として登録する。
>$ sudo useradd -G user <ユーザ名> 
3. ```passwd```コマンドを発行し、登録するユーザアカウントに対しパスワードを設定する。
>$ sudo passwd <ユーザ名>

## ユーザ削除について

本章では、ユーザの削除を行う際の規則及び手続きについて規定する。

### 削除の規則について
ユーザを削除すると、そのユーザに関連するファイル群も同時に、システムから削除されるため、慎重に行う必要がある。  
ユーザの削除は、以下のようなケースにおいてのみ、実行されるものとする。  
1. あるユーザアカウントを保有するユーザが、卒業などの要因でシステムを保有する団体から、脱退する場合
2. あるユーザアカウントについて、システム運営を阻害するような手続きが確認され、改善されない場合
3. その他の要因により、あるユーザアカウントをシステムから削除しなければならない場合

### 削除の手続きについて
以下に、ユーザの削除を行う際の手続きを示す。
1. 削除対象のユーザについて、管理者・モデレータ間で確認を行う。これは、削除対象の誤りを避けるための対策である。
2. ```admin```ユーザグループに属するユーザアカウントで、システムへログインする。
3. ```userdel```コマンドを発行し、ユーザ削除を行う。削除対象のユーザに関連するファイル群(ホームディレクトリ下のファイル)も削除するため、```-r```オプションを付与する。
>$ sudo userdel -r <ユーザ名>

## ユーザに対する権限の付与・剥奪について

本章では、ユーザに対する権限の付与及び剥奪の概要及び手続きについて規定する。

### 権限の付与について
以下のケースに該当する場合に、権限の付与を行う。
1. あるユーザがシステムの保守・管理を担当する場合
2. モデレータが引き継ぎ等により、管理者となる場合
3. あるユーザが実験等のために、Dockerコマンドを使用する必要が生じた場合(Option)

実際に権限を付与する際は、管理者管轄の下、以下のような手続きで実施する。

1. 付与する権限と対象ユーザについて、管理者・モデレータ間で確認を行う。
2. 管理者ユーザがシステムにログインする。
3. ```gpasswd```コマンドを発行し、付与する権限に対応するユーザグループに、対象ユーザを追加する。  
>$ sudo gpasswd -a <ユーザ名> <ユーザグループ名>

### 権限の剥奪について
以下のケースに該当する場合に、権限の剥奪を行う。
1. あるユーザが引き継ぎ等により、保守・管理担当から外れる場合
2. 管理者が引き継ぎ等により、管理者グループから外れる場合
3. あるユーザが違反行為などにより、権限剥奪をするべきと判断された場合
4. あるユーザが実験等に使用していたDockerコマンドが、不要となった場合

実際に権限を剥奪する場合は、管理者管轄の下、以下のような手続きで実施する。

1. 剥奪する権限と対象ユーザについて、管理者・モデレータ間で確認を行う。
2. 管理者ユーザがシステムにログインする。
3. ```gpasswd```コマンドを発行し、剥奪する権限に対応するユーザグループから、対象ユーザを削除する。
>$ sudo gpasswd -d <ユーザ名> <ユーザグループ名>

